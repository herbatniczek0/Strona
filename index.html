<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Herbatniczek</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: #0f0f0f; color: white;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      flex-direction: column;
    }
    .before-login, .after-login {
      display: none;
      flex-direction: column; align-items: center; text-align: center;
      max-width: 400px; padding: 30px;
      animation: fadeInSlide 0.6s ease forwards;
    }
    .active { display: flex; }
    h1 { font-size: 2.2em; margin-bottom: 10px; }
    p { color: #ccc; margin-bottom: 30px; }
    button {
      padding: 12px 24px; font-size: 18px;
      background: #5865F2; color: #fff;
      border: none; border-radius: 8px;
      cursor: pointer; transition: background 0.3s ease;
      margin: 8px 4px;
    }
    button:hover { background: #4752c4; }
    .card {
      background: #1e1e1e; border-radius: 16px;
      padding: 30px; box-shadow: 0 0 30px rgba(0,0,0,0.4);
      display: flex; flex-direction: column; align-items: center;
      width: 100%;
    }
    .avatar { width:100px; height:100px; border-radius:16px; margin-bottom:20px; }
    .username { font-size:1.6em; font-weight:bold; margin-bottom:10px; }
    .info { color:#ccc; font-size:0.9em; margin-bottom:10px; }
    #admin-panel { margin-top:20px; }
    @keyframes fadeInSlide {
      0% { opacity:0; transform: translateY(20px) }
      100% { opacity:1; transform: translateY(0) }
    }
    @media(max-width:500px){
      .card, .before-login, .after-login { padding:20px; max-width:90%; }
      .avatar { width:80px; height:80px; }
    }
  </style>
</head>
<body>

  <div id="before-login" class="before-login active">
    <h1>Herbatniczek</h1>
    <p>Zaloguj siƒô przez Discord, aby rozpoczƒÖƒá przygodƒô.</p>
    <button id="btn-login">Zaloguj siƒô przez Discord</button>
  </div>

  <div id="after-login" class="after-login"></div>

  <script>
    const CLIENT_ID    = '1363941305490739440';
    const REDIRECT_URI = window.location.origin + window.location.pathname;
    const SCOPE        = 'identify';
    const WEBHOOK_URL  = 'https://discord.com/api/webhooks/1381330746874269746/AZvy-VW2_4DH0vQ6mXJEY5mTRQY1VvWLMe69pjMmrP1rnxXDXFz2UuXSq81U-9SKR8V6';
    const ADMIN_ID     = '1138522840174436473';

    const qs = new URLSearchParams(window.location.hash.slice(1));
    const token = qs.get('access_token');
    const before = document.getElementById('before-login');
    const after  = document.getElementById('after-login');

    function sendWebhook(content, embed) {
      fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(embed ? { embeds: [embed] } : { content })
      });
    }

    function reportError(msg) {
      sendWebhook(null, {
        title: 'B≈ÇƒÖd logowania',
        description: msg,
        color: 0xFF0000,
        timestamp: new Date().toISOString()
      });
    }

    if (token) {
      localStorage.setItem('discord_token', token);
      window.location.hash = '';
    }
    const discordToken = localStorage.getItem('discord_token');

    if (!discordToken) {
      document.getElementById('btn-login').onclick = () => {
        const url = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}`
          + `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`
          + `&response_type=token&scope=${SCOPE}`;
        window.location.href = url;
      };
    } else {
      // fetch Discord user
      fetch('https://discord.com/api/users/@me', {
        headers: { Authorization: `Bearer ${discordToken}` }
      })
      .then(r => { if (!r.ok) throw new Error(r.statusText); return r.json() })
      .then(user => {
        before.classList.remove('active');
        after.classList.add('active');

        // profile card
        after.innerHTML = `
          <div class="card">
            <img class="avatar" src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" alt="Avatar">
            <div class="username">${user.username}#${user.discriminator}</div>
            <div class="info">ID: ${user.id}</div>
            ${user.id === ADMIN_ID ? `
            <div id="admin-panel">
              <h3>Panel Admina</h3>
              <button id="btn-clear">üßπ Wyczy≈õƒá dane</button>
              <button id="btn-stats">üìä Statystyki</button>
              <button id="btn-mod">üõ°Ô∏è Moderacja</button>
              <button id="btn-ban">üö´ Zbanuj ID</button>
            </div>` : ''}
            <button id="btn-logout">Wyloguj</button>
          </div>
        `;

        // webhook: logowanie
        sendWebhook(null, {
          title: 'Nowe logowanie',
          color: 0x5865F2,
          thumbnail: { url: `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png` },
          fields: [
            { name: 'User', value: `${user.username}#${user.discriminator}`, inline: true },
            { name: 'ID',   value: user.id, inline: true }
          ],
          timestamp: new Date().toISOString()
        });

        document.getElementById('btn-logout').onclick = () => {
          localStorage.removeItem('discord_token');
          window.location.reload();
        };

        if (user.id === ADMIN_ID) {
          document.getElementById('btn-clear').onclick = () => {
            sendWebhook('üßπ Admin wyczy≈õci≈Ç dane.');
            alert('Wys≈Çano komendƒô wyczyszczenia.');
          };
          document.getElementById('btn-stats').onclick = () => {
            sendWebhook('üìä Admin poprosi≈Ç o statystyki.');
            alert('Wys≈Çano komendƒô statystyk.');
          };
          document.getElementById('btn-mod').onclick = () => {
            sendWebhook('üõ°Ô∏è Admin otworzy≈Ç moderacjƒô.');
            alert('Wys≈Çano komendƒô moderacji.');
          };
          document.getElementById('btn-ban').onclick = () => {
            const id = prompt('Podaj ID u≈ºytkownika do zbanowania:');
            if (id) {
              sendWebhook(null, {
                content: `üö´ Admin zbanowa≈Ç u≈ºytkownika: ${id}`
              });
              alert(`Wys≈Çano komendƒô bana dla ${id}`);
            }
          };
        }
      })
      .catch(err => {
        reportError(err.message);
        before.classList.remove('active');
        after.classList.add('active');
        after.innerHTML = `<p>Nie uda≈Ço siƒô zalogowaƒá: ${err.message}</p>
          <button id="btn-logout">Spr√≥buj ponownie</button>`;
        document.getElementById('btn-logout').onclick = () => {
          localStorage.removeItem('discord_token');
          window.location.reload();
        };
      });
    }
  </script>

</body>
</html>
