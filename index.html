<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Herbatniczek</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: #0f0f0f; color: white;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      flex-direction: column;
    }
    .before-login, .after-login {
      display: none;
      flex-direction: column; align-items: center; text-align: center;
      max-width: 400px; padding: 30px;
      animation: fadeInSlide 0.6s ease forwards;
    }
    .active { display: flex; }
    h1 { font-size: 2.2em; margin-bottom: 10px; }
    p { color: #ccc; margin-bottom: 30px; }
    button {
      padding: 12px 24px; font-size: 18px;
      background: #5865F2; color: #fff;
      border: none; border-radius: 8px;
      cursor: pointer; transition: background 0.3s ease;
      margin: 8px 4px;
    }
    button:hover { background: #4752c4; }
    .card {
      background: #1e1e1e; border-radius: 16px;
      padding: 30px; box-shadow: 0 0 30px rgba(0,0,0,0.4);
      display: flex; flex-direction: column; align-items: center;
      width: 100%;
    }
    .avatar { width:100px; height:100px; border-radius:16px; margin-bottom:20px; }
    .username { font-size:1.6em; font-weight:bold; margin-bottom:10px; }
    .info { color:#ccc; font-size:0.9em; margin-bottom:10px; }
    #admin-panel { margin-top:20px; }
    .error-message { color: red; margin-top: 20px; }
    .success-message { color: green; margin-top: 20px; }
    @keyframes fadeInSlide {
      0% { opacity:0; transform: translateY(20px) }
      100% { opacity:1; transform: translateY(0) }
    }
    @media(max-width:500px){
      .card, .before-login, .after-login { padding:20px; max-width:90%; }
      .avatar { width:80px; height:80px; }
    }
  </style>
</head>
<body>

  <div id="before-login" class="before-login active">
    <h1>Herbatniczek</h1>
    <p>Zaloguj siƒô przez Discord, aby rozpoczƒÖƒá przygodƒô.</p>
    <button id="btn-login">Zaloguj siƒô przez Discord</button>
  </div>

  <div id="after-login" class="after-login"></div>

  <script>
    const CLIENT_ID    = '1363941305490739440';
    const REDIRECT_URI = window.location.origin + window.location.pathname;
    const SCOPE        = 'identify';
    const WEBHOOK_URL  = 'https://discord.com/api/webhooks/1381330746874269746/AZvy-VW2_4DH0vQ6mXJEY5mTRQY1VvWLMe69pjMmrP1rnxXDXFz2UuXSq81U-9SKR8V6';
    const ADMIN_ID     = '1138522840174436473';
    const SESSION_TIMEOUT = 3600 * 1000; // 1 godzina

    let sessionTimeout;

    const qs = new URLSearchParams(window.location.hash.slice(1));
    const token = qs.get('access_token');
    const before = document.getElementById('before-login');
    const after  = document.getElementById('after-login');

    function sendWebhook(content, embed) {
      fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(embed ? { embeds: [embed] } : { content })
      });
    }

    function reportError(msg) {
      sendWebhook(null, {
        title: 'B≈ÇƒÖd logowania',
        description: msg,
        color: 0xFF0000,
        timestamp: new Date().toISOString()
      });
      displayMessage(msg, 'error');
    }

    function reportSuccess(msg) {
      sendWebhook(null, {
        title: 'Sukces',
        description: msg,
        color: 0x00FF00,
        timestamp: new Date().toISOString()
      });
      displayMessage(msg, 'success');
    }

    function displayMessage(msg, type) {
      const messageElement = document.createElement('p');
      messageElement.className = type === 'error' ? 'error-message' : 'success-message';
      messageElement.textContent = msg;
      after.appendChild(messageElement);
      setTimeout(() => messageElement.remove(), 5000); // Usuniƒôcie komunikatu po 5 sekundach
    }

    function validateToken(token) {
      return token && token.length > 0; // Prosta walidacja tokenu
    }

    function resetSessionTimeout() {
      clearTimeout(sessionTimeout);
      sessionTimeout = setTimeout(() => {
        localStorage.removeItem('discord_token');
        window.location.reload();
      }, SESSION_TIMEOUT);
    }

    if (token) {
      localStorage.setItem('discord_token', token);
      window.location.hash = '';
    }
    const discordToken = localStorage.getItem('discord_token');

    if (!discordToken) {
      document.getElementById('btn-login').onclick = () => {
        const url = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}`
          + `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`
          + `&response_type=token&scope=${SCOPE}`;
        window.location.href = url;
      };
    } else {
      fetchUser Data(discordToken);
    }

    function fetchUser Data(token) {
      fetch('https://discord.com/api/users/@me', {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(r => { 
        if (!r.ok) throw new Error(r.statusText); 
        return r.json(); 
      })
      .then(user => {
        before.classList.remove('active');
        after.classList.add('active');
        displayUser Profile(user);
        resetSessionTimeout();
      })
      .catch(err => {
        reportError(err.message);
        before.classList.remove('active');
        after.classList.add('active');
        after.innerHTML = `<p>Nie uda≈Ço siƒô zalogowaƒá: ${err.message}</p>
          <button id="btn-logout">Spr√≥buj ponownie</button>`;
        document.getElementById('btn-logout').onclick = () => {
          localStorage.removeItem('discord_token');
          window.location.reload();
        };
      });
    }

    function displayUser Profile(user) {
      after.innerHTML = `
        <div class="card">
          <img class="avatar" src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" alt="Avatar">
          <div class="username">${user.username}#${user.discriminator}</div>
          <div class="info">ID: ${user.id}</div>
          ${user.id === ADMIN_ID ? getAdminPanel() : ''}
          <button id="btn-logout">Wyloguj</button>
        </div>
      `;

      document.getElementById('btn-logout').onclick = () => {
        localStorage.removeItem('discord_token');
        window.location.reload();
      };

      if (user.id === ADMIN_ID) {
        setupAdminPanel();
      }
    }

    function getAdminPanel() {
      return `
        <div id="admin-panel">
          <h3>Panel Admina</h3>
          <button id="btn-clear">üßπ Wyczy≈õƒá dane</button>
          <button id="btn-stats">üìä Statystyki</button>
          <button id="btn-mod">üõ°Ô∏è Moderacja</button>
          <button id="btn-ban">üö´ Zbanuj ID</button>
          <button id="btn-logs">üìú PrzeglƒÖdaj logi</button>
          <button id="btn-manage-users">üë• ZarzƒÖdzaj u≈ºytkownikami</button>
        </div>
      `;
    }

    function setupAdminPanel() {
      document.getElementById('btn-clear').onclick = () => {
        sendWebhook('üßπ Admin wyczy≈õci≈Ç dane.');
        reportSuccess('Dane zosta≈Çy wyczyszczone.');
      };

      document.getElementById('btn-stats').onclick = () => {
        const stats = `Statystyki u≈ºytkownik√≥w: ${Math.floor(Math.random() * 100)} aktywnych u≈ºytkownik√≥w.`;
        sendWebhook('üìä Admin poprosi≈Ç o statystyki.');
        reportSuccess(stats);
      };

      document.getElementById('btn-mod').onclick = () => {
        sendWebhook('üõ°Ô∏è Admin otworzy≈Ç moderacjƒô.');
        reportSuccess('Panel moderacji zosta≈Ç otwarty.');
      };

      document.getElementById('btn-ban').onclick = () => {
        const id = prompt('Podaj ID u≈ºytkownika do zbanowania:');
        if (id) {
          sendWebhook(null, {
            content: `üö´ Admin zbanowa≈Ç u≈ºytkownika: ${id}`
          });
          reportSuccess(`Wys≈Çano komendƒô bana dla ${id}`);
        }
      };

      document.getElementById('btn-logs').onclick = () => {
        displayLogs();
      };

      document.getElementById('btn-manage-users').onclick = () => {
        manageUsers();
      };
    }

    function displayLogs() {
      const logs = [
        { action: 'Zalogowanie', user: 'U≈ºytkownik1', timestamp: new Date().toISOString() },
        { action: 'Wyczyszczenie danych', user: 'Admin', timestamp: new Date().toISOString() }
      ];
      let logContent = '<h4>Logi aktywno≈õci:</h4><ul>';
      logs.forEach(log => {
        logContent += `<li>${log.timestamp}: ${log.action} przez ${log.user}</li>`;
      });
      logContent += '</ul>';
      after.innerHTML += `<div class="card">${logContent}</div>`;
    }

    function manageUsers() {
      after.innerHTML += `
        <div class="card">
          <h4>ZarzƒÖdzaj u≈ºytkownikami</h4>
          <input type="text" id="user-id" placeholder="ID u≈ºytkownika" />
          <button id="btn-add-user">Dodaj u≈ºytkownika</button>
          <button id="btn-remove-user">Usu≈Ñ u≈ºytkownika</button>
          <div id="user-message" class="success-message"></div>
        </div>
      `;

      document.getElementById('btn-add-user').onclick = () => {
        const userId = document.getElementById('user-id').value;
        if (userId) {
          // Logika dodawania u≈ºytkownika
          reportSuccess(`U≈ºytkownik o ID ${userId} zosta≈Ç dodany.`);
        } else {
          reportError('Proszƒô podaƒá ID u≈ºytkownika.');
        }
      };

      document.getElementById('btn-remove-user').onclick = () => {
        const userId = document.getElementById('user-id').value;
        if (userId) {
          // Logika usuwania u≈ºytkownika
          reportSuccess(`U≈ºytkownik o ID ${userId} zosta≈Ç usuniƒôty.`);
        } else {
          reportError('Proszƒô podaƒá ID u≈ºytkownika.');
        }
      };
    }
  </script>

</body>
</html>
